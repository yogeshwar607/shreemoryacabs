---
import { generateBreadcrumbSchema } from '@/lib/seo';
import StructuredData from './StructuredData.astro';
import { ChevronRight, Home } from 'lucide-react';

interface BreadcrumbItem {
  name: string;
  href?: string;
  url?: string;
}

interface Props {
  items: BreadcrumbItem[];
}

const { items } = Astro.props;

// Normalize items to use 'url' property (handle both href and url for backwards compatibility)
const normalizedItems = items.map(item => ({
  name: item.name,
  url: item.url || item.href || '/'
}));

// Always include Home as first item
const allItems = [{ name: 'Home', url: '/' }, ...normalizedItems];
const breadcrumbSchema = generateBreadcrumbSchema(allItems);
---

<StructuredData data={breadcrumbSchema} />

<nav aria-label="Breadcrumb" class="mb-4">
  <ol class="flex items-center flex-wrap gap-2 text-sm text-muted-foreground">
    {allItems.map((item, index) => (
      <li class="flex items-center gap-2">
        {index > 0 && <ChevronRight class="w-4 h-4" />}
        {index === allItems.length - 1 ? (
          <span class="font-medium text-foreground" aria-current="page">
            {item.name}
          </span>
        ) : (
          <a
            href={item.url || '/'}
            class="hover:text-primary transition-colors"
          >
            {index === 0 ? (
              <span class="flex items-center gap-1">
                <Home class="w-4 h-4" />
                <span>{item.name}</span>
              </span>
            ) : (
              item.name
            )}
          </a>
        )}
      </li>
    ))}
  </ol>
</nav>
